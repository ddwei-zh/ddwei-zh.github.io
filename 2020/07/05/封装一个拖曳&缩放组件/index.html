<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
        <title>封装一个拖曳&amp;缩放组件 | Mint Forge</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel='shortcut icon' href="/favicon.ico">
    
<link rel="stylesheet" href="/css/index.css">

    
<link rel="stylesheet" href="/css/plugins/highlight/dark.css">

    
<link rel="stylesheet" href="/css/plugins/iconfont/iconfont.css">

<meta name="generator" content="Hexo 4.2.1"></head>
<body>
    <div class="navbar-container">
    <div class="navbar">
        <ul>
            <li><a href="/">MINT FORGE</a></li>
            <li><a href="/">首页</a></li>
            <li><a href='/categories'>CATEGORIES</a></li>
            <li><a href="/tags">TAGS</a></li>
            <li><a href="/about">ABOUT</a></li>
        </ul>
    </div>
</div>
    <div class="all-container">
        <div class="article-container">
    <h2 class="title">封装一个拖曳&amp;缩放组件</h2>
    <span class="info">2020年7月5日</span>
    
    
        <div class="toc">
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#常用的组件"><span class="toc-number">1.</span> <span class="toc-text">常用的组件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#手写一个"><span class="toc-number">1.1.</span> <span class="toc-text">手写一个</span></a></li></ol></li></ol>
        </div>
    

    <div class="content"><h1 id="常用的组件"><a href="#常用的组件" class="headerlink" title="常用的组件"></a>常用的组件</h1><ul>
<li><a href="https://juejin.im/post/5beb9423e51d4577f96e8d24" target="_blank" rel="noopener">vue-drag-resize</a></li>
<li><a href="https://segmentfault.com/a/1190000016445230" target="_blank" rel="noopener">vue-draggable-resizeable</a>  <h2 id="手写一个"><a href="#手写一个" class="headerlink" title="手写一个"></a>手写一个</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line">    &#x2F;**</span><br><span class="line"> * @author ddwei</span><br><span class="line"> * @description 拖拽缩放插件</span><br><span class="line"> *&#x2F;</span><br><span class="line">export default class Drag_scale &#123;</span><br><span class="line">  constructor(target, options) &#123;</span><br><span class="line">    this._init(target, options);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 初始化绑定节点</span><br><span class="line">   * @param &#123;HTMLElement|String&#125; target 目标元素</span><br><span class="line">   * @param &#123;Object&#125; options 选项</span><br><span class="line">   *&#x2F;</span><br><span class="line">  _init(target, options) &#123;</span><br><span class="line">    if (!target) throw new Error(&quot;el为必填项&quot;);</span><br><span class="line"></span><br><span class="line">    this.el &#x3D;</span><br><span class="line">      typeof target &#x3D;&#x3D;&#x3D; &quot;string&quot; ? document.querySelector(target) : target;</span><br><span class="line"></span><br><span class="line">    this._defaultOptions &#x3D; &#123;</span><br><span class="line">      rotate: 0, &#x2F;&#x2F; 图旋转角度</span><br><span class="line">      minScale: 1, &#x2F;&#x2F; 最小缩放比例</span><br><span class="line">      maxScale: 3 &#x2F;&#x2F; 最大缩放比例</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    this.options &#x3D; &#123;</span><br><span class="line">      ...this._defaultOptions,</span><br><span class="line">      ...options</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 缩放</span><br><span class="line">    this.maxScale &#x3D; this.options.maxScale;</span><br><span class="line">    this.minScale &#x3D; this.options.minScale;</span><br><span class="line">    this.scale &#x3D; this.options.scale || 1; &#x2F;&#x2F; 初始缩放比例设置为1</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 拖拽</span><br><span class="line">    this.dragTransformX &#x3D; 0;</span><br><span class="line">    this.dragTransformY &#x3D; 0;</span><br><span class="line">    &#x2F;&#x2F;拖拽历史点</span><br><span class="line">    this.lastDragPoint &#x3D; &#123;</span><br><span class="line">      x: 0,</span><br><span class="line">      y: 0</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    this.rotate &#x3D; this.options.rotate;</span><br><span class="line"></span><br><span class="line">    this.eventList &#x3D; [</span><br><span class="line">      &#123;</span><br><span class="line">        name: &quot;mousemove&quot;,</span><br><span class="line">        handler: this._handleDragMove.bind(this)</span><br><span class="line">      &#125;</span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 绑定事件对象</span><br><span class="line">    this.el.addEventListener(&quot;mousedown&quot;, e &#x3D;&gt; &#123;</span><br><span class="line">      this._handleDragStart(e);</span><br><span class="line">      this.eventList.forEach((&#123; name, handler &#125;) &#x3D;&gt; &#123;</span><br><span class="line">        this.el.addEventListener(name, handler, false);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; 鼠标抬起解绑move事件</span><br><span class="line">    this.el.addEventListener(&quot;mouseup&quot;, e &#x3D;&gt; &#123;</span><br><span class="line">      this._cleanEvent(this.eventList);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 处理缩放,旋转，拖拽</span><br><span class="line">   *&#x2F;</span><br><span class="line">  _setTransform(x, y, scale, rotate, transition &#x3D; false) &#123;</span><br><span class="line">    if (!this.el) return;</span><br><span class="line"></span><br><span class="line">    const text &#x3D; &#96;transform:scale($&#123;scale&#125;) rotate($&#123;rotate&#125;deg) translate3d($&#123;x&#125;px,$&#123;y&#125;px,0);transform-origin:center;)&#96;;</span><br><span class="line">    const cssText &#x3D; transition ? text + &quot;transition:0.3s;&quot; : text;</span><br><span class="line"></span><br><span class="line">    this.el.setAttribute(&quot;style&quot;, cssText);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 设置缩放比例</span><br><span class="line">   * @param &#123;Number&#125; scale 缩放比例</span><br><span class="line">   *&#x2F;</span><br><span class="line">  setScale(scale) &#123;</span><br><span class="line">    let s &#x3D; parseFloat(scale);</span><br><span class="line">    if (isNaN(s)) return;</span><br><span class="line"></span><br><span class="line">    if (s &lt; this.minScale) s &#x3D; this.minScale;</span><br><span class="line">    if (s &gt; this.maxScale) s &#x3D; this.maxScale;</span><br><span class="line"></span><br><span class="line">    this.scale &#x3D; s;</span><br><span class="line"></span><br><span class="line">    this._setTransform(</span><br><span class="line">      this.dragTransformX,</span><br><span class="line">      this.dragTransformY,</span><br><span class="line">      this.scale,</span><br><span class="line">      this.rotate</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;**</span><br><span class="line">   * scale + 0.1</span><br><span class="line">   *&#x2F;</span><br><span class="line">  makeScaleAddZeroPointOne() &#123;</span><br><span class="line">    let newScale &#x3D; this.scale + 0.1;</span><br><span class="line">    this.setScale(newScale);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * scale - 0.1</span><br><span class="line">   *&#x2F;</span><br><span class="line">  makeScaleSubtractZeroPointOne() &#123;</span><br><span class="line">    let newScale &#x3D; this.scale - 0.1;</span><br><span class="line">    this.setScale(newScale);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 旋转api</span><br><span class="line">   * @param   &#123;Number&#125;  direction  方向 1顺时针 -1逆时针</span><br><span class="line">   *&#x2F;</span><br><span class="line">  rotateHandler(direction &#x3D; 1) &#123;</span><br><span class="line">    if (![1, -1].includes(direction)) return;</span><br><span class="line"></span><br><span class="line">    this.rotate &#x3D; this.rotateFormat(this.rotate + direction * 90);</span><br><span class="line"></span><br><span class="line">    this._setTransform(</span><br><span class="line">      this.dragTransformX,</span><br><span class="line">      this.dragTransformY,</span><br><span class="line">      this.scale,</span><br><span class="line">      this.rotate</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 旋转角度处理</span><br><span class="line">   * @return  &#123;Number&#125;  旋转角</span><br><span class="line">   *&#x2F;</span><br><span class="line">  rotateFormat(angle) &#123;</span><br><span class="line">    if (typeof angle !&#x3D;&#x3D; &quot;number&quot; || isNaN(angle)) return;</span><br><span class="line"></span><br><span class="line">    const temp &#x3D; angle % 360;</span><br><span class="line">    const newAngle &#x3D; temp &lt; 0 ? temp + 360 : temp;</span><br><span class="line"></span><br><span class="line">    return Math.abs(newAngle);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 解绑事件</span><br><span class="line">  _cleanEvent(eventList) &#123;</span><br><span class="line">    if (!this.el || eventList.length &#x3D;&#x3D; 0) return;</span><br><span class="line">    eventList.forEach((&#123; name, handler &#125;) &#x3D;&gt; &#123;</span><br><span class="line">      this.el.removeEventListener(name, handler, false);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 处理指针结束</span><br><span class="line">   * @param &#123;MouseEvent|TouchEvent&#125; e 事件对象</span><br><span class="line">   * @returns void</span><br><span class="line">   *&#x2F;</span><br><span class="line">  _handlePointerEnd(e) &#123;</span><br><span class="line">    &#x2F;&#x2F; 解绑相关事件</span><br><span class="line">    this._cleanEvent(this.eventList);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 获取事件相对触发对象的偏移值</span><br><span class="line">   * @param &#123;MouseEvent|TouchEvent&#125; e 事件对象</span><br><span class="line">   * @returns 偏移值对象</span><br><span class="line">   *&#x2F;</span><br><span class="line">  _getPointOffset(e) &#123;</span><br><span class="line">    if (e instanceof MouseEvent) &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        x: e.offsetX,</span><br><span class="line">        y: e.offsetY</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125; else if (e instanceof TouchEvent) &#123;</span><br><span class="line">      const &#123; touches, target &#125; &#x3D; e;</span><br><span class="line"></span><br><span class="line">      const &#123; clientX, clientY &#125; &#x3D; touches[0];</span><br><span class="line">      const &#123; left, top &#125; &#x3D; target.getBoundingClientRect();</span><br><span class="line"></span><br><span class="line">      return &#123;</span><br><span class="line">        x: clientX - left,</span><br><span class="line">        y: clientY - top</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 处理拖拽开始</span><br><span class="line">   *&#x2F;</span><br><span class="line">  _handleDragStart(e) &#123;</span><br><span class="line">    this.lastDragPoint &#x3D; this._getPointOffset(e);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;**</span><br><span class="line">   * 处理拖拽移动</span><br><span class="line">   *&#x2F;</span><br><span class="line">  _handleDragMove(e) &#123;</span><br><span class="line">    const &#123; x, y &#125; &#x3D; this._getPointOffset(e);</span><br><span class="line"></span><br><span class="line">    const &#123; x: lastX, y: lastY &#125; &#x3D; this.lastDragPoint;</span><br><span class="line"></span><br><span class="line">    this.dragTransformX +&#x3D; x - lastX;</span><br><span class="line">    this.dragTransformY +&#x3D; y - lastY;</span><br><span class="line"></span><br><span class="line">    this._setTransform(</span><br><span class="line">      this.dragTransformX,</span><br><span class="line">      this.dragTransformY,</span><br><span class="line">      this.scale,</span><br><span class="line">      this.rotate</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 绑定事件对象</span><br><span class="line">  _bindEvent() &#123;</span><br><span class="line">    &#x2F;&#x2F; this._handleDragStart &#x3D; this._handleDragStart.bind(this)</span><br><span class="line">    &#x2F;&#x2F; this._handleDragMove &#x3D; this._handleDragMove.bind(this)</span><br><span class="line">    &#x2F;&#x2F; this._handlePointerEnd &#x3D; this._handlePointerEnd.bind(this)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><code>使用方式</code>  <pre><code>new Drag_scale($el)</code></pre></li>
</ul>
</div>
    <hr>
    <div class="tags"></div>
</div>
<div class="paging">
    
    
        <a id="prev" href="/2020/07/05/%E6%9C%AC%E5%9C%B0%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E7%9C%8Bvue%E5%BA%94%E7%94%A8%E5%9C%A8%E7%BA%BF%E4%B8%8A%E7%9A%84%E6%95%88%E6%9E%9C/">PREV_PAGE</a>
    
    
        <a id="next" href="/2020/07/05/%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E3%80%81%E6%8C%87%E4%BB%A4%E3%80%81%E6%8F%92%E4%BB%B6/">NEXT_PAGE</a>
    
</div>
<div class="footer">
    <p><a href="/about/">Please Contact the Author before Reproduce.</a></p>
</div>

<script src="/js/highlight.pack.js"></script>

</script>
<script>
	hljs.initHighlightingOnLoad();
</script>

<script src="/js/iconfont.js"></script>

<style>
    .icon {
      width: 1rem;
      height: 1rem;
      vertical-align: -0.15em;
      fill: currentColor;
      overflow: hidden;
    }
</style>
    
    </div>
    <div class='rights'>
	<p>©<span id='years'></span> Mint Forge. All Rights Reserved.</p>
</div>
<script type="text/javascript">
	var today = new Date()
	var years = today.getFullYear()
	document.getElementById('years').innerHTML=years
</script>
    
<script src="/js/iconfont.js"></script>

<style>
    .icon {
      width: 1rem;
      height: 1rem;
      vertical-align: -0.15em;
      fill: currentColor;
      overflow: hidden;
    }
</style>
    
</body>
</html>